@using Mindr.WebAssembly.Client.Components
@using Mindr.Domain.HttpRunner.Models;
@using Mindr.WebAssembly.Client.Pages.Connectors.Components
@using MudBlazor

@namespace Mindr.WebAssembly.Client.Pages.Connectors.Views
@inherits LayoutComponentBase

<MudStack Style="width: 100%;">
    <MudStack Row="true">
        <MudButton StartIcon="@Icons.Material.Filled.Save" IconColor="Color.Primary" Size="Size.Large" @onclick="HandleOnSave" Disabled="@(!DataHasChanged)">Save</MudButton>
        <MudButton StartIcon="@Icons.Material.Filled.Add" IconColor="Color.Primary" Size="Size.Large" @onclick="HandleHttpDrawerOpen">Add</MudButton>
        <MudButton StartIcon="@Icons.Material.Filled.LocalPlay" IconColor="Color.Primary" Size="Size.Large" @onclick="HandleOnRunAll">Run All</MudButton>
    </MudStack>
    @if (IsLoading)
    {
        <MudProgressLinear Color="Color.Info" Indeterminate="true" />
    }
    else if (HttpItems?.Any() == true)
    {
        <Dropzone Items="HttpItems">
            <HttpItemCard Data="@context"
                      IsSelected="@(SelectedHttpItem?.Id == context.Id)"
                      OnRemove="@OnHandleRemove"
                      OnSelect="@OnHandleChange" />
            @*<HttpItemSettings Data="@SelectedHttpItem"
                              OnUpdate="@OnOpenEditor"
                              OnChange="@OnHandleChange" />*@
        </Dropzone>
    }
</MudStack>


@*<Stack Orientation="Orientation.Vertical" VerticalGap="0" Style="border-top: 1px solid #00000026;">
    <Stack Orientation="Orientation.Horizontal" Class="editable-stack" HorizontalGap="0">
        <FluentButton Disabled="@(!DataHasChanged)" Appearance="Appearance.Stealth" Style="border-radius: 0;" @onclick="HandleOnSave">
            <FluentIcon Slot="start" Name="@FluentIcons.Save" Size="@IconSize.Size16" Variant="@IconVariant.Regular" Color="@Color.Accent" />
            Save
        </FluentButton>
        <FluentButton Appearance="Appearance.Stealth" Style="border-radius: 0;" @onclick="HttpItemEditor.OpenAddDialog">
            <FluentIcon Slot="start" Name="@FluentIcons.Add" Size="@IconSize.Size16" Variant="@IconVariant.Regular" Color="@Color.Accent" />
            Add
        </FluentButton>
        <FluentButton Appearance="Appearance.Stealth" Style="border-radius: 0;" @onclick="HandleOnRunAll">
            <FluentIcon Slot="start" Name="@FluentIcons.Play" Size="@IconSize.Size16" Variant="@IconVariant.Regular" Color="@Color.Accent" />
            Run
        </FluentButton>
    </Stack>*@
    @*<Stack Orientation="Orientation.Horizontal">
        @if (!string.IsNullOrEmpty(ErrorMessage))
        {
            <Stack Style="min-height:50px;border: 1px solid #D8000C;background-color: #FFBABA;padding: 3px;">
                @ErrorMessage
            </Stack>
        }
        @if (IsLoading)
        {
            <Stack HorizontalAlignment="StackHorizontalAlignment.Center" VerticalAlignment="StackVerticalAlignment.Center">
                <FluentProgressRing />
            </Stack>
        else if (HttpItems?.Any() == true)
        {
            <Dropzone Items="HttpItems">
                <HttpItemCard Data="@context" 
                    IsSelected="@(SelectedHttpItem?.Id == context.Id)"
                    OnRemove="@OnHandleRemove"
                    OnSelect="@OnHandleChange"
                />
            </Dropzone>
        }
        <HttpItemSettings 
            Data="@SelectedHttpItem"
            OnUpdate="@OnOpenEditor"
            OnChange="@OnHandleChange" 
        />
        }
        
    </Stack>
    <HttpItemDialog 
        @ref="@HttpItemEditor" 
        Data="SelectedHttpItem ?? new HttpItem()" 
        OnCreate="OnHandleCreate" 
        OnUpdate="OnHandleUpdate" 
    />
</Stack>
        *@
        
